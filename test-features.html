<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KMTC ìƒˆ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">ğŸ§ª KMTC ìƒˆ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
        
        <!-- PWA ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“± PWA ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
            <div class="space-y-4">
                <button id="testServiceWorker" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ í…ŒìŠ¤íŠ¸
                </button>
                <button id="testNotification" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    í‘¸ì‹œ ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
                </button>
                <button id="testInstallPrompt" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    ì•± ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸
                </button>
                <div id="pwaStatus" class="p-4 bg-gray-100 rounded"></div>
            </div>
        </div>

        <!-- ì•Œë¦¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ”” ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h2>
            <div class="space-y-4">
                <button id="testLocalNotification" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    ë¡œì»¬ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
                </button>
                <button id="testAlertRule" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                    ì•Œë¦¼ ê·œì¹™ ìƒì„± í…ŒìŠ¤íŠ¸
                </button>
                <div id="notificationStatus" class="p-4 bg-gray-100 rounded"></div>
            </div>
        </div>

        <!-- ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ’¾ ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸</h2>
            <div class="space-y-4">
                <button id="testLocalStorage" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸
                </button>
                <button id="testCacheAPI" class="bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600">
                    ìºì‹œ API í…ŒìŠ¤íŠ¸
                </button>
                <div id="storageStatus" class="p-4 bg-gray-100 rounded"></div>
            </div>
        </div>

        <!-- ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold mb-4">ğŸŒ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í…ŒìŠ¤íŠ¸</h2>
            <div class="space-y-4">
                <div id="networkStatus" class="p-4 bg-gray-100 rounded">
                    ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: <span id="onlineStatus" class="font-bold"></span>
                </div>
                <button id="testOfflineMode" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì‹œë®¬ë ˆì´ì…˜
                </button>
            </div>
        </div>
    </div>

    <script>
        // PWA ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
        document.getElementById('testServiceWorker').addEventListener('click', async () => {
            const status = document.getElementById('pwaStatus');
            
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    status.innerHTML = `âœ… ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì„±ê³µ: ${registration.scope}`;
                    status.className = 'p-4 bg-green-100 text-green-800 rounded';
                } catch (error) {
                    status.innerHTML = `âŒ ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì‹¤íŒ¨: ${error.message}`;
                    status.className = 'p-4 bg-red-100 text-red-800 rounded';
                }
            } else {
                status.innerHTML = 'âŒ ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.';
                status.className = 'p-4 bg-red-100 text-red-800 rounded';
            }
        });

        document.getElementById('testNotification').addEventListener('click', async () => {
            const status = document.getElementById('pwaStatus');
            
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    new Notification('KMTC í…ŒìŠ¤íŠ¸ ì•Œë¦¼', {
                        body: 'í‘¸ì‹œ ì•Œë¦¼ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!',
                        icon: '/icons/icon-192x192.png'
                    });
                    status.innerHTML = 'âœ… ì•Œë¦¼ ê¶Œí•œ í—ˆìš©ë¨ - í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡';
                    status.className = 'p-4 bg-green-100 text-green-800 rounded';
                } else {
                    status.innerHTML = 'âŒ ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    status.className = 'p-4 bg-red-100 text-red-800 rounded';
                }
            } else {
                status.innerHTML = 'âŒ ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.';
                status.className = 'p-4 bg-red-100 text-red-800 rounded';
            }
        });

        document.getElementById('testInstallPrompt').addEventListener('click', () => {
            const status = document.getElementById('pwaStatus');
            
            // beforeinstallprompt ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸
            if (window.deferredPrompt) {
                window.deferredPrompt.prompt();
                status.innerHTML = 'âœ… ì•± ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ í‘œì‹œë¨';
                status.className = 'p-4 bg-green-100 text-green-800 rounded';
            } else {
                status.innerHTML = 'âš ï¸ ì•± ì„¤ì¹˜ ì¡°ê±´ì´ ì¶©ì¡±ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì´ë¯¸ ì„¤ì¹˜ë¨';
                status.className = 'p-4 bg-yellow-100 text-yellow-800 rounded';
            }
        });

        // ì•Œë¦¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        document.getElementById('testLocalNotification').addEventListener('click', () => {
            const status = document.getElementById('notificationStatus');
            
            // ê°€ìƒì˜ ì•Œë¦¼ ë°ì´í„° ìƒì„±
            const mockAlert = {
                id: Date.now().toString(),
                type: 'rate_drop',
                title: 'í…ŒìŠ¤íŠ¸ ìš´ì„ í•˜ë½ ì•Œë¦¼',
                message: 'í•œêµ­-LA ì„œì•ˆ í•­ë¡œ ìš´ì„ì´ $2,750ìœ¼ë¡œ í•˜ë½í–ˆìŠµë‹ˆë‹¤.',
                timestamp: new Date(),
                priority: 'high'
            };
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            const alerts = JSON.parse(localStorage.getItem('testAlerts') || '[]');
            alerts.unshift(mockAlert);
            localStorage.setItem('testAlerts', JSON.stringify(alerts));
            
            status.innerHTML = `âœ… í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ìƒì„±ë¨: ${mockAlert.title}`;
            status.className = 'p-4 bg-green-100 text-green-800 rounded';
        });

        document.getElementById('testAlertRule').addEventListener('click', () => {
            const status = document.getElementById('notificationStatus');
            
            // ê°€ìƒì˜ ì•Œë¦¼ ê·œì¹™ ìƒì„±
            const mockRule = {
                id: Date.now().toString(),
                name: 'í…ŒìŠ¤íŠ¸ LA í•­ë¡œ ì•Œë¦¼',
                type: 'rate_threshold',
                enabled: true,
                conditions: {
                    routes: ['kr-la'],
                    threshold: 2800,
                    comparison: 'below'
                },
                channels: { push: true, email: true, sms: false },
                frequency: 'immediate',
                priority: 'high'
            };
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            const rules = JSON.parse(localStorage.getItem('notificationRules') || '[]');
            rules.push(mockRule);
            localStorage.setItem('notificationRules', JSON.stringify(rules));
            
            status.innerHTML = `âœ… ì•Œë¦¼ ê·œì¹™ ìƒì„±ë¨: ${mockRule.name}`;
            status.className = 'p-4 bg-green-100 text-green-800 rounded';
        });

        // ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸
        document.getElementById('testLocalStorage').addEventListener('click', () => {
            const status = document.getElementById('storageStatus');
            
            try {
                const testData = {
                    timestamp: new Date().toISOString(),
                    testValue: Math.random()
                };
                
                localStorage.setItem('kmtc_test', JSON.stringify(testData));
                const retrieved = JSON.parse(localStorage.getItem('kmtc_test'));
                
                status.innerHTML = `âœ… ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸ ì„±ê³µ<br>ì €ì¥ëœ ë°ì´í„°: ${JSON.stringify(retrieved, null, 2)}`;
                status.className = 'p-4 bg-green-100 text-green-800 rounded';
            } catch (error) {
                status.innerHTML = `âŒ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                status.className = 'p-4 bg-red-100 text-red-800 rounded';
            }
        });

        document.getElementById('testCacheAPI').addEventListener('click', async () => {
            const status = document.getElementById('storageStatus');
            
            if ('caches' in window) {
                try {
                    const cache = await caches.open('kmtc-test-cache');
                    const testResponse = new Response(JSON.stringify({
                        message: 'Cache API í…ŒìŠ¤íŠ¸ ì„±ê³µ',
                        timestamp: new Date().toISOString()
                    }));
                    
                    await cache.put('/test-cache', testResponse);
                    const cached = await cache.match('/test-cache');
                    const data = await cached.json();
                    
                    status.innerHTML = `âœ… ìºì‹œ API í…ŒìŠ¤íŠ¸ ì„±ê³µ<br>ìºì‹œëœ ë°ì´í„°: ${JSON.stringify(data, null, 2)}`;
                    status.className = 'p-4 bg-green-100 text-green-800 rounded';
                } catch (error) {
                    status.innerHTML = `âŒ ìºì‹œ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                    status.className = 'p-4 bg-red-100 text-red-800 rounded';
                }
            } else {
                status.innerHTML = 'âŒ ìºì‹œ APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.';
                status.className = 'p-4 bg-red-100 text-red-800 rounded';
            }
        });

        // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
        function updateNetworkStatus() {
            const status = document.getElementById('onlineStatus');
            if (navigator.onLine) {
                status.textContent = 'ì˜¨ë¼ì¸ âœ…';
                status.className = 'font-bold text-green-600';
            } else {
                status.textContent = 'ì˜¤í”„ë¼ì¸ âŒ';
                status.className = 'font-bold text-red-600';
            }
        }

        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);
        updateNetworkStatus();

        document.getElementById('testOfflineMode').addEventListener('click', () => {
            alert('ê°œë°œì ë„êµ¬ > Network íƒ­ì—ì„œ "Offline" ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•˜ì—¬ ì˜¤í”„ë¼ì¸ ëª¨ë“œë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        });

        // beforeinstallprompt ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            window.deferredPrompt = e;
            console.log('PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì¤€ë¹„ë¨');
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìƒíƒœ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('KMTC ìƒˆ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
            
            // PWA ì§€ì› ì—¬ë¶€ í™•ì¸
            const pwaStatus = document.getElementById('pwaStatus');
            const features = [];
            
            if ('serviceWorker' in navigator) features.push('Service Worker âœ…');
            else features.push('Service Worker âŒ');
            
            if ('Notification' in window) features.push('Notifications âœ…');
            else features.push('Notifications âŒ');
            
            if ('caches' in window) features.push('Cache API âœ…');
            else features.push('Cache API âŒ');
            
            pwaStatus.innerHTML = `ë¸Œë¼ìš°ì € PWA ì§€ì› í˜„í™©:<br>${features.join('<br>')}`;
            
            // ìë™ìœ¼ë¡œ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            setTimeout(() => {
                console.log('ğŸš€ ìë™ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹œì‘');
                runBasicTests();
            }, 1000);
        });

        // ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ìë™ ì‹¤í–‰
        function runBasicTests() {
            console.log('ğŸ“Š ê¸°ë³¸ ë°ì´í„° êµ¬ì¡° í…ŒìŠ¤íŠ¸');
            
            // ì•Œë¦¼ ê·œì¹™ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
            const testRule = {
                id: Date.now().toString(),
                name: 'ìë™ í…ŒìŠ¤íŠ¸ LA í•­ë¡œ ì•Œë¦¼',
                type: 'rate_threshold',
                enabled: true,
                conditions: {
                    routes: ['kr-la'],
                    threshold: 2800,
                    comparison: 'below'
                },
                channels: { push: true, email: true, sms: false },
                frequency: 'immediate',
                priority: 'high'
            };
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            try {
                const existingRules = JSON.parse(localStorage.getItem('notificationRules') || '[]');
                existingRules.push(testRule);
                localStorage.setItem('notificationRules', JSON.stringify(existingRules));
                console.log('âœ… ì•Œë¦¼ ê·œì¹™ ìë™ ìƒì„± ì™„ë£Œ:', testRule.name);
            } catch (error) {
                console.error('âŒ ì•Œë¦¼ ê·œì¹™ ìƒì„± ì‹¤íŒ¨:', error);
            }
            
            // ë¶€í‚¹ íˆìŠ¤í† ë¦¬ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
            const testBooking = {
                id: `BK${Date.now()}`,
                bookingNumber: `KMTC${new Date().toISOString().slice(0, 10).replace(/-/g, '')}001`,
                route: 'kr-la',
                containerType: '40HC',
                quantity: Math.floor(Math.random() * 50) + 10,
                rate: 2500 + Math.floor(Math.random() * 500),
                bookingDate: new Date(),
                status: 'confirmed',
                aiRecommended: Math.random() > 0.5,
                savings: Math.floor(Math.random() * 200) + 50
            };
            
            try {
                const existingBookings = JSON.parse(localStorage.getItem('testBookings') || '[]');
                existingBookings.push(testBooking);
                localStorage.setItem('testBookings', JSON.stringify(existingBookings));
                console.log('âœ… ë¶€í‚¹ ë°ì´í„° ìë™ ìƒì„± ì™„ë£Œ:', testBooking.bookingNumber);
            } catch (error) {
                console.error('âŒ ë¶€í‚¹ ë°ì´í„° ìƒì„± ì‹¤íŒ¨:', error);
            }
            
            // í˜‘ì—… ë°ì´í„° í…ŒìŠ¤íŠ¸
            const testCollaboration = {
                id: `collab-${Date.now()}`,
                bookingNumber: testBooking.bookingNumber,
                sharedBy: 'Test User',
                sharedAt: new Date(),
                status: 'pending',
                comments: [
                    {
                        id: `comment-${Date.now()}`,
                        author: 'Auto Tester',
                        content: 'ìë™ í…ŒìŠ¤íŠ¸ë¡œ ìƒì„±ëœ ëŒ“ê¸€ì…ë‹ˆë‹¤.',
                        timestamp: new Date(),
                        likes: 0,
                        liked: false
                    }
                ]
            };
            
            try {
                const existingCollabs = JSON.parse(localStorage.getItem('testCollaborations') || '[]');
                existingCollabs.push(testCollaboration);
                localStorage.setItem('testCollaborations', JSON.stringify(existingCollabs));
                console.log('âœ… í˜‘ì—… ë°ì´í„° ìë™ ìƒì„± ì™„ë£Œ:', testCollaboration.id);
            } catch (error) {
                console.error('âŒ í˜‘ì—… ë°ì´í„° ìƒì„± ì‹¤íŒ¨:', error);
            }
            
            console.log('ğŸ‰ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ');
            
            // ì €ì¥ëœ ë°ì´í„° í™•ì¸
            const savedRules = JSON.parse(localStorage.getItem('notificationRules') || '[]');
            const savedBookings = JSON.parse(localStorage.getItem('testBookings') || '[]');
            const savedCollabs = JSON.parse(localStorage.getItem('testCollaborations') || '[]');
            
            console.log(`ğŸ“Š ì €ì¥ëœ ë°ì´í„° í˜„í™©:
- ì•Œë¦¼ ê·œì¹™: ${savedRules.length}ê°œ
- ë¶€í‚¹ ë°ì´í„°: ${savedBookings.length}ê°œ  
- í˜‘ì—… ë°ì´í„°: ${savedCollabs.length}ê°œ`);
        }
    </script>
</body>
</html>